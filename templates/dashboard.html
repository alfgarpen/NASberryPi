{% extends "layout.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="card">
    <h3><i class="fas fa-hdd"></i> Disk Usage</h3>

    <div style="display: flex; gap: 2rem; align-items: center; justify-content: center; flex-wrap: wrap;">
        <!-- Simple CSS-based visualization or standard stats -->
        <div style="text-align: center;">
            <div style="
                width: 150px; 
                height: 150px; 
                border-radius: 50%; 
                --percent: {{ disk.percent }}%;
                background: conic-gradient(var(--primary-color) var(--percent), #e9ecef 0);
                display: flex; 
                align-items: center; 
                justify-content: center;
                margin: 0 auto 1rem auto;
            ">
                <div style="
                    width: 120px; 
                    height: 120px; 
                    background: white; 
                    border-radius: 50%; 
                    display: flex; 
                    align-items: center; 
                    justify-content: center;
                    flex-direction: column;
                ">
                    <span style="font-size: 1.5rem; font-weight: bold;">{{ disk.percent }}%</span>
                    <span style="color: #6c757d; font-size: 0.9rem;">Used</span>
                </div>
            </div>
        </div>

        <div style="min-width: 200px;">
            <table style="width: 100%;">
                <tr>
                    <td><strong>Total Space:</strong></td>
                    <td>{{ disk.total }} GB</td>
                </tr>
                <tr>
                    <td><strong>Used Space:</strong></td>
                    <td>{{ disk.used }} GB</td>
                </tr>
                <tr>
                    <td><strong>Free Space:</strong></td>
                    <td>{{ disk.free }} GB</td>
                </tr>
            </table>
        </div>
    </div>
</div>

<div class="card">
    <h3><i class="fas fa-user-circle"></i> My Profile</h3>
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <p><strong>Username:</strong> {{ session.username }}</p>
            <p><strong>Role:</strong>
                <span class="badge {% if session.role == 'admin' %}badge-danger{% else %}badge-info{% endif %}">{{
                    session.role }}</span>
            </p>
        </div>

        {% if session.role != 'admin' %}
        <div style="border-left: 2px solid #eee; padding-left: 20px;">
            <h5>Shared Folder Access</h5>
            {% if shared_req %}
            <p>Status:
                <span
                    class="badge {% if shared_req.status == 'approved' %}bg-success{% elif shared_req.status == 'pending' %}bg-warning{% else %}bg-danger{% endif %} text-uppercase">
                    {{ shared_req.status }}
                </span>
            </p>
            {% if shared_req.status == 'approved' %}
            <a href="{{ url_for('files', req_path='shared') }}" class="btn btn-sm">Visit Shared Folder</a>
            {% elif shared_req.status == 'rejected' %}
            <form action="{{ url_for('request_shared_access') }}" method="POST">
                <button type="submit" class="btn btn-sm btn-warning">Request Access Again</button>
            </form>
            {% endif %}
            {% else %}
            <p class="text-muted small">No access yet.</p>
            <form action="{{ url_for('request_shared_access') }}" method="POST">
                <button type="submit" class="btn btn-sm">Request Shared Access</button>
            </form>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

<div class="card">
    <h3><i class="fas fa-folder-open"></i> File Manager</h3>
    <p>Access your personal files or shared folders.</p>
    <a href="{{ url_for('files') }}" class="btn">Manage Files</a>
</div>
{% if session.role == 'admin' %}
<div class="card" style="border-left: 5px solid var(--danger-color);">
    <h3><i class="fas fa-shield-alt"></i> Administration</h3>
    <p>Manage users, disks, and access requests.</p>
    <div style="display: flex; gap: 10px;">
        <a href="{{ url_for('users') }}" class="btn">Manage Users</a>
        <a href="{{ url_for('admin_requests') }}" class="btn">Manage Requests</a>
    </div>
</div>
{% endif %}
{% endblock %}