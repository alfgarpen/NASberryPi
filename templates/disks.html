{% extends "layout.html" %}

{% block title %}Disk Manager{% endblock %}

{% block content %}
<div class="card">
    <h3><i class="fas fa-hdd"></i> Physical Disks</h3>
    <div id="disk-list">
        <p>Loading disk information...</p>
    </div>
</div>

<div class="card">
    <h3><i class="fas fa-layer-group"></i> RAID Arrays</h3>
    <div class="actions-bar" style="margin-bottom: 1rem;">
        <button class="btn btn-primary" onclick="openCreateRaidModal()">
            <i class="fas fa-plus"></i> Create RAID Array
        </button>
    </div>
    <div id="raid-list">
        <p>Loading RAID information...</p>
    </div>
</div>

<!-- Modal: Create Partition -->
<div id="modal-create-part" class="modal"
    style="display:none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
    <div class="modal-content"
        style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 400px; border-radius: 8px;">
        <span class="close" onclick="closeModal('modal-create-part')"
            style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
        <h2>Create Partition</h2>
        <form id="form-create-part">
            <input type="hidden" id="cp-disk-path">
            <div class="form-group">
                <label>Size (MB):</label>
                <input type="number" id="cp-size" required class="form-control"
                    style="width: 100%; padding: 8px; margin: 5px 0 15px;">
            </div>
            <div class="form-group">
                <label>File System:</label>
                <select id="cp-fs" class="form-control" style="width: 100%; padding: 8px; margin: 5px 0 15px;">
                    <option value="ext4">ext4</option>
                    <option value="ntfs">NTFS</option>
                    <option value="fat32">FAT32</option>
                </select>
            </div>
            <button type="submit" class="btn" style="background-color: #28a745; color: white;">Create</button>
        </form>
    </div>
</div>

<!-- Modal: Format Partition -->
<div id="modal-format-part" class="modal"
    style="display:none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
    <div class="modal-content"
        style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 400px; border-radius: 8px;">
        <span class="close" onclick="closeModal('modal-format-part')"
            style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
        <h2>Format Partition</h2>
        <p>Warning: All data on <span id="fp-name"></span> will be lost!</p>
        <form id="form-format-part">
            <input type="hidden" id="fp-path">
            <div class="form-group">
                <label>New File System:</label>
                <select id="fp-fs" class="form-control" style="width: 100%; padding: 8px; margin: 5px 0 15px;">
                    <option value="ext4">ext4</option>
                    <option value="ntfs">NTFS</option>
                    <option value="fat32">FAT32</option>
                </select>
            </div>
            <button type="submit" class="btn" style="background-color: #dc3545; color: white;">Format</button>
        </form>
    </div>
</div>

<!-- Modal: Create RAID -->
<div id="modal-create-raid" class="modal"
    style="display:none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
    <div class="modal-content"
        style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 500px; border-radius: 8px;">
        <span class="close" onclick="closeModal('modal-create-raid')"
            style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
        <h2>Create RAID Array</h2>
        <form id="form-create-raid">
            <div class="form-group">
                <label>RAID Level:</label>
                <select id="cr-level" class="form-control" style="width: 100%; padding: 8px; margin: 5px 0 15px;">
                    <option value="0">RAID 0 (Stripe)</option>
                    <option value="1">RAID 1 (Mirror)</option>
                    <option value="5">RAID 5 (Parity)</option>
                    <option value="10">RAID 10</option>
                </select>
            </div>
            <div class="form-group">
                <label>Select Partitions (Must be unused):</label>
                <div id="cr-devices"
                    style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
                    <!-- Checkboxes populated by JS -->
                </div>
            </div>
            <br>
            <button type="submit" class="btn" style="background-color: #007bff; color: white;">Create RAID</button>
        </form>
    </div>
</div>

<script src="{{ url_for('static', filename='js/disk_manager.js') }}"></script>
{% endblock %}